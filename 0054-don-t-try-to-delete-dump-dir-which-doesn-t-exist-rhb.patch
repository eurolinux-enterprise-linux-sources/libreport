From f49eebc43bb248e3ed9c6222f9fbd84b4ab3a242 Mon Sep 17 00:00:00 2001
From: Jiri Moskovcak <jmoskovc@redhat.com>
Date: Mon, 6 Aug 2012 16:43:23 +0200
Subject: [PATCH 54/56] don't try to delete dump dir which doesn't exist
 rhbz#799909

Conflicts:
	po/POTFILES.in
---
 po/POTFILES.in      |  2 ++
 src/lib/abrt_sock.c | 14 ++++++++++++--
 2 files changed, 14 insertions(+), 2 deletions(-)

diff --git a/po/POTFILES.in b/po/POTFILES.in
index 91e1415..353b67c 100644
--- a/po/POTFILES.in
+++ b/po/POTFILES.in
@@ -9,6 +9,8 @@ src/gtk-helpers/event_config_dialog.c
 src/gui-wizard-gtk/main.c
 src/gui-wizard-gtk/wizard.c
 src/gui-wizard-gtk/wizard.glade
+src/lib/abrt_sock.c
+src/lib/create_dump_dir.c
 src/lib/event_config.c
 src/lib/parse_options.c
 src/lib/abrt_curl.c
diff --git a/src/lib/abrt_sock.c b/src/lib/abrt_sock.c
index b2c9928..b595208 100644
--- a/src/lib/abrt_sock.c
+++ b/src/lib/abrt_sock.c
@@ -53,7 +53,7 @@ static int connect_to_abrtd_and_call_DeleteDebugDump(const char *dump_dir_name)
     }
     else
     {
-        perror_msg("Can't connect to '%s'", SOCKET_FILE);
+        VERB1 perror_msg("Can't connect to '%s'", SOCKET_FILE);
     }
     close(socketfd);
 
@@ -70,7 +70,17 @@ int delete_dump_dir_possibly_using_abrtd(const char *dump_dir_name)
             return dd_delete(dd);
         dd_close(dd);
     }
+    else
+    {
+        if (errno == ENOENT || errno == ENOTDIR)
+            /* No such dir, no point in trying to talk over socket */
+            return 1;
+    }
 
     VERB1 log("Deleting '%s' via abrtd", dump_dir_name);
-    return connect_to_abrtd_and_call_DeleteDebugDump(dump_dir_name);
+    const int res = connect_to_abrtd_and_call_DeleteDebugDump(dump_dir_name);
+    if (res != 0)
+        error_msg(_("Can't delete: '%s'"), dump_dir_name);
+
+    return res;
 }
-- 
1.7.11.4

