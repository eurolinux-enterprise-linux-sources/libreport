From 9212f1e8903c1cfdb538e91ab683263be264b2fc Mon Sep 17 00:00:00 2001
From: Martin Milata <mmilata@redhat.com>
Date: Tue, 8 Oct 2013 16:31:41 +0200
Subject: [LIBREPORT PATCH 109/111] Include hostname in mailx notification

Closes rhbz#989530.

Signed-off-by: Martin Milata <mmilata@redhat.com>
---
 src/include/internal_libreport.h |  5 ++---
 src/lib/make_descr.c             | 28 ++++++++++++++++++++++++++++
 src/plugins/reporter-mailx.c     |  3 +--
 3 files changed, 31 insertions(+), 5 deletions(-)

diff --git a/src/include/internal_libreport.h b/src/include/internal_libreport.h
index 72688c4..036032f 100644
--- a/src/include/internal_libreport.h
+++ b/src/include/internal_libreport.h
@@ -597,9 +597,8 @@ char *make_description_item_multiline(const char *name, const char* content);
 char* make_description_bz(problem_data_t *problem_data, unsigned max_text_size);
 #define make_description_logger libreport_make_description_logger
 char* make_description_logger(problem_data_t *problem_data, unsigned max_text_size);
-//UNUSED
-//#define make_description_mailx libreport_make_description_mailx
-//char* make_description_mailx(problem_data_t *problem_data);
+#define make_description_mailx libreport_make_description_mailx
+char* make_description_mailx(problem_data_t *problem_data, unsigned max_text_size);
 
 #define parse_release_for_bz libreport_parse_release_for_bz
 void parse_release_for_bz(const char *pRelease, char **product, char **version);
diff --git a/src/lib/make_descr.c b/src/lib/make_descr.c
index 4ff23da..a4e7938 100644
--- a/src/lib/make_descr.c
+++ b/src/lib/make_descr.c
@@ -279,6 +279,24 @@ static const char *const blacklisted_items[] = {
     NULL
 };
 
+/* Items we don't want to include in email */
+static const char *const blacklisted_items_mailx[] = {
+    CD_DUMPDIR        ,
+    FILENAME_ANALYZER ,
+    FILENAME_TYPE     ,
+    FILENAME_COREDUMP ,
+    FILENAME_DUPHASH  ,
+    FILENAME_UUID     ,
+    FILENAME_COUNT    ,
+    FILENAME_TAINTED_SHORT,
+    FILENAME_ARCHITECTURE,
+    FILENAME_PACKAGE,
+    FILENAME_OS_RELEASE,
+    FILENAME_COMPONENT,
+    FILENAME_REASON,
+    NULL
+};
+
 char* make_description_bz(problem_data_t *problem_data, unsigned max_text_size)
 {
     return make_description(
@@ -298,3 +316,13 @@ char* make_description_logger(problem_data_t *problem_data, unsigned max_text_si
                 MAKEDESC_SHOW_FILES | MAKEDESC_SHOW_MULTILINE
     );
 }
+
+char* make_description_mailx(problem_data_t *problem_data, unsigned max_text_size)
+{
+    return make_description(
+                problem_data,
+                (char**)blacklisted_items_mailx,
+                max_text_size,
+                MAKEDESC_SHOW_FILES | MAKEDESC_SHOW_MULTILINE
+    );
+}
diff --git a/src/plugins/reporter-mailx.c b/src/plugins/reporter-mailx.c
index 83d12e8..821a31d 100644
--- a/src/plugins/reporter-mailx.c
+++ b/src/plugins/reporter-mailx.c
@@ -76,8 +76,7 @@ static void create_and_send_email(
     unsigned arg_size = 0;
     args = append_str_to_vector(args, &arg_size, "/bin/mailx");
 
-    //char *dsc = make_description_mailx(problem_data);
-    char *dsc = make_description_bz(problem_data, CD_TEXT_ATT_SIZE_LOGGER);
+    char *dsc = make_description_mailx(problem_data, CD_TEXT_ATT_SIZE_LOGGER);
 
     if (send_binary_data)
     {
-- 
1.8.3.1

