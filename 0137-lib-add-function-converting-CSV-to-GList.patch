From c020b5c4d1d5bb14c9fb907a82d5eb080ffe0abd Mon Sep 17 00:00:00 2001
From: Jakub Filak <jfilak@redhat.com>
Date: Wed, 18 Feb 2015 11:21:46 +0100
Subject: [LIBREPORT PATCH] lib: add function converting CSV to GList

Signed-off-by: Jakub Filak <jfilak@redhat.com>
---
 src/include/internal_libreport.h |  2 ++
 src/lib/glib_support.c           | 28 ++++++++++++++++++++++++++++
 2 files changed, 30 insertions(+)

diff --git a/src/include/internal_libreport.h b/src/include/internal_libreport.h
index b812ea8..86d9329 100644
--- a/src/include/internal_libreport.h
+++ b/src/include/internal_libreport.h
@@ -646,6 +646,8 @@ void free_file_list(GList *filelist);
 file_obj_t *new_file_obj(const char* fullpath, const char* filename);
 #define free_file_obj libreport_free_file_obj
 void free_file_obj(file_obj_t *f);
+#define parse_list libreport_parse_list
+GList *parse_list(const char* list);
 
 /* Connect to abrtd over unix domain socket, issue DELETE command */
 int delete_dump_dir_possibly_using_abrtd(const char *dump_dir_name);
diff --git a/src/lib/glib_support.c b/src/lib/glib_support.c
index 1180537..8b34f05 100644
--- a/src/lib/glib_support.c
+++ b/src/lib/glib_support.c
@@ -18,6 +18,34 @@
 */
 #include "internal_libreport.h"
 
+#define LIST_DELIMITER ","
+
+/*
+ * Parser comma separated list of strings to Glist
+ *
+ * @param list comma separated list of strings
+ * @returns GList or null if the list is empty
+ */
+GList *parse_list(const char* list)
+{
+    if (list == NULL)
+        return NULL;
+
+    GList *l = NULL;
+
+    char *saved_ptr = NULL;
+    char *tmp_list = xstrdup(list);
+    char *item = strtok_r(tmp_list, LIST_DELIMITER, &saved_ptr);
+    while (item)
+    {
+        l = g_list_append(l, strtrim(xstrdup(item)));
+        item = strtok_r(NULL, LIST_DELIMITER, &saved_ptr);
+    }
+
+    free(tmp_list);
+    return l;
+}
+
 void list_free_with_free(GList *list)
 {
     GList *li;
-- 
1.8.3.1

