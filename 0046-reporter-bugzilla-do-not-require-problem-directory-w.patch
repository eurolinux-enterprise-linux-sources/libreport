From 44de9e6ac3505b885836afa5cff9863ac3b20348 Mon Sep 17 00:00:00 2001
From: Denys Vlasenko <vda.linux@googlemail.com>
Date: Mon, 30 Jul 2012 14:15:27 +0200
Subject: [PATCH 46/53] reporter-bugzilla: do not require problem directory
 with -tBUG_ID. Closes rhbz#817051

Signed-off-by: Denys Vlasenko <vda.linux@googlemail.com>
---
 src/plugins/reporter-bugzilla.c | 13 ++++++-------
 1 file changed, 6 insertions(+), 7 deletions(-)

diff --git a/src/plugins/reporter-bugzilla.c b/src/plugins/reporter-bugzilla.c
index ee0da0f..145359c 100644
--- a/src/plugins/reporter-bugzilla.c
+++ b/src/plugins/reporter-bugzilla.c
@@ -178,12 +178,6 @@ int main(int argc, char **argv)
     if (!rhbz.b_login[0] || !rhbz.b_password[0])
         error_msg_and_die(_("Empty login or password, please check your configuration"));
 
-    struct dump_dir *dd = dd_opendir(dump_dir_name, /*flags:*/ 0);
-    if (!dd)
-        xfunc_die();
-    report_result_t *reported_to = find_in_reported_to(dd, "Bugzilla:");
-    dd_close(dd);
-
     if (opts & OPT_t)
     {
         if (!ticket_no)
@@ -200,7 +194,6 @@ int main(int argc, char **argv)
 //            free_report_result(reported_to);
 //            ...
         }
-        free_report_result(reported_to);
 
         /* Attach files to existing BZ */
         if (!argv[0])
@@ -245,6 +238,12 @@ int main(int argc, char **argv)
 
     /* Create new bug in Bugzilla */
 
+    struct dump_dir *dd = dd_opendir(dump_dir_name, /*flags:*/ 0);
+    if (!dd)
+        xfunc_die();
+    report_result_t *reported_to = find_in_reported_to(dd, "Bugzilla:");
+    dd_close(dd);
+
     if (reported_to && reported_to->url && !(opts & OPT_f))
     {
         char *msg = xasprintf("This problem was already reported to Bugzilla (see '%s')."
-- 
1.7.11.2

